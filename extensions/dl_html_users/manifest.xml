<?xml version="1.0" encoding="utf-8"?>
<extension engine="1.0">
	<id>dl_html_users</id>
	<title>DL HTML user</title>
	<version>1.1</version>
	<description>Позволяет вставлять html код, в профиль пользователей (под аватаром). 
	Внимание! Тестировалось только на сборке Flazy: http://flazy.ru</description>
	<author>Ипатьев (De-Luxis) Степан c помощью Ильи (Flazy)</author>
	<minversion>0.2.2</minversion>
	<maxtestedon>1.3.4</maxtestedon>
	<install>
		<![CDATA[
			$forum_db->add_field('users', 'html_user', 'TEXT', true);
			$forum_db->add_field('users', 'html_user_set', 'INT(1) UNSIGNED', false, '0');
			$forum_db->add_field('users', 'html_user_display', 'INT(1) UNSIGNED', false, '1');
		]]>
	</install>
	<uninstall>
		<![CDATA[
			$forum_db->drop_field('users', 'html_user');
			$forum_db->drop_field('users', 'html_user_set');
			$forum_db->drop_field('users', 'html_user_display');
		]]>
	</uninstall>
	<hooks>
		<hook id="vt_row_pre_post_contacts_merge">
<![CDATA[
	if ($forum_user['html_user_display']) {
	$html_user = str_replace(array('&lt;','&gt;','&quot;'), array('<','>','"'), forum_htmlencode($cur_post['html_user']));
	$forum_page['author_info']['html_user'] = $html_user ;};
]]>
		</hook>
		<hook id="vt_qr_get_posts">
<![CDATA[
	$query['SELECT'] .= ', u.html_user, u.html_user_display';
]]>
		</hook>
		<hook id="pf_security_qr_registration_ip">
<![CDATA[
	$query['SELECT'] .= ', u.html_user, u.html_user_set, u.html_user_display';
]]>
		</hook>
		<hook id="pf_change_details_settings_pre_email_fieldset_end">
<![CDATA[
if (file_exists($ext_info['path'].'/lang/'.$forum_user['language'].'/'.$ext_info['id'].'.php'))
		include_once $ext_info['path'].'/lang/'.$forum_user['language'].'/'.$ext_info['id'].'.php';
	else
		include_once $ext_info['path'].'/lang/English/'.$ext_info['id'].'.php';	?>
	<fieldset class="mf-set set<?php echo ++$forum_page['item_count'] ?>">
		<legend><span><?echo ($lang_dl_html_users['Name']);?></span></legend>
			<div class="mf-box">
				<div class="mf-item"> 
					<span class="fld-input"><input type="checkbox" id="fld<?php echo $forum_page['fld_count'] ?>" name="form[html_user_display]" value="1" <?php if ($user['html_user_display']) echo 'checked="checked"'; ?>/></span>
					<label for="fld<?php echo ++$forum_page['fld_count'] ?>"><?echo ($lang_dl_html_users['User display']);?></label> 
				</div> 
			<? if ($forum_user['g_id'] == $forum_user['is_admmod'] or $user['html_user_set']!=0){ ?>
				<div class="txt-box textarea">
					<div class="sig-demo"><?php $html_user = str_replace(array('&lt;','&gt;','&quot;'), array('<','>','"'), forum_htmlencode($user['html_user']));
echo $forum_page['author_info']['html_user'] = $html_user; ?></div>
				</div>
					<div class="txt-input"><span class="fld-input">
						<textarea id="fld<?php echo ++$forum_page['fld_count'] ?>" class="inputbox" name="form[html_user]" rows="10" cols="80">
<?echo $forum_page['html_user'] = forum_htmlencode($user['html_user']); ?></textarea></span>
					</div>
				<? if ($forum_user['g_id'] == $forum_user['is_admmod']){ ?>
					<div class="mf-item"> 
						<span class="fld-input"><input type="checkbox" id="fld<?php echo $forum_page['fld_count'] ?>" name="form[html_user_set]" value="1" <?php if ($user['html_user_set']) echo 'checked="checked"'; ?>/></span>
						<label for="fld<?php echo ++$forum_page['fld_count'] ?>"><?echo ($lang_dl_html_users['User edit']);?></label>
					</div>
				<? }}?>
			</div>
	</fieldset><?
]]>
		</hook>
		<hook id="pf_change_details_settings_validation">
		<![CDATA[
		if (!empty($_POST['form']['html_user_display'])) $form['html_user_display']='1'; else $form['html_user_display']='0';
		if (!isset($_POST['html_user']) && $forum_user['g_id'] == $forum_user['is_admmod'] or $user['html_user_set']!=0) $form['html_user'] = $_POST['form']['html_user'];
		if (!empty($_POST['form']['html_user_set'])) $form['html_user_set']='1'; else if ($forum_user['g_id'] == $forum_user['is_admmod']) $form['html_user_set']='0';
		]]>
		</hook>
	</hooks>
</extension>